"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.messageMapper = void 0;
const wechaty_1 = require("wechaty");
function messageMapper(mapperOptions) {
    wechaty_1.log.verbose('WechatyPluginContrib', 'messageMapper(%s)', typeof mapperOptions === 'function'
        ? 'function'
        : JSON.stringify(mapperOptions));
    return async function mapMessage(message) {
        wechaty_1.log.verbose('WechatyPluginContrib', 'mapMessage(%s)', message);
        return normalizeMappedMessageList(mapperOptions, message);
    };
}
exports.messageMapper = messageMapper;
async function normalizeMappedMessageList(options, message) {
    wechaty_1.log.verbose('WechatyPluginContrib', 'normalizeMappedMessageList(%s, %s)', JSON.stringify(options), message);
    const msgList = [];
    let optionList;
    if (Array.isArray(options)) {
        optionList = options;
    }
    else {
        optionList = [options];
    }
    for (const option of optionList) {
        if (!option) {
            continue;
        }
        if (typeof option === 'function') {
            const ret = await option(message);
            if (ret) {
                msgList.push(...await normalizeMappedMessageList(ret, message));
            }
        }
        else {
            msgList.push(option);
        }
    }
    return msgList;
}
//# sourceMappingURL=message-mapper.js.map