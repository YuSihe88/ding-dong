"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SimpleEnvironment = void 0;
const wechaty_puppet_1 = require("wechaty-puppet");
const SimpleEnvironment = () => {
    wechaty_puppet_1.log.verbose('SimpleEnvironment', '()');
    return function SimpleEnvironmentStart(mocker) {
        wechaty_puppet_1.log.verbose('SimpleEnvironment', 'SimpleEnvironmentStart(%s)', mocker);
        const taskList = [];
        const loop = () => taskList.forEach(task => task());
        const timer = setInterval(loop, 5000);
        const SimpleEnvironmentStop = () => {
            wechaty_puppet_1.log.verbose('SimpleEnvironment', 'SimpleEnvironmentStop()');
            clearInterval(timer);
        };
        mocker.scan('https://github.com/wechaty/wechaty-puppet-mock', wechaty_puppet_1.ScanStatus.Waiting);
        const user = mocker.createContact();
        mocker.login(user);
        const contactList = mocker.createContacts(3);
        mocker.createRoom({
            memberIdList: [
                user.id,
                ...contactList.map(c => c.id),
            ],
        });
        taskList.push(() => {
            const contact = mocker.randomContact();
            if (contact) {
                contact.say().to();
            }
        });
        return SimpleEnvironmentStop;
    };
};
exports.SimpleEnvironment = SimpleEnvironment;
//# sourceMappingURL=environment.js.map